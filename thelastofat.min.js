function C(a,b){return b?(c=b,K=M[W=b-(a%2?2-a:a*A-A)],K-4||(M[c=W]=M[b],M[b]=4),c):Math.random()*a|0}M=I=" +/U.@^#$",P=A=50,Z=[,5,0,D=L=0];onload=onkeydown=function(e){Z[1]>0?P=C(e.which%4,d=P):W=P;s=(e=K-6)&&K<9?K<4?(Z[K]++,M[W]=4):d-P?D||(M[Q]=4,M[Q=d]=8):0:M[W]=K>12&&Z[2]?(Z[2]--,1+C(3)):K>9?K-1:C(3)||4;if(!e&&(M=[],d=[],e=[],D?L>0&&--L:++L)){for(f=3*L;f--;){for(g=(1+C(32))*A+1+C(32),h=9+C(9),i=h*h,j=0,k=[],l=M.slice();i--;)j|=l[m=g+i%h+(i/h|0)*A],l[m]=f%3&&C(5)>3?7:(n=k.push(m),4);L%3&&j||(o=p=d.push(q=k),e.push(r=n),M=l)}for(f=A*A;f--;)M[f]=M[f]||7;for(;o--;)for(a=d[o][C(e[o])],b=q[C(r)];a^b;)M[a+=C(2)?a%A>b%A?-1:1:a/A>b/A?-A:A]=4;for(f=5+L;f--;)M[Q=P=d[x=C(p)][C(e[x])]]=f<2?5+f:9+C(9)}for(d in e=M.slice())s&&(f=e[d])>8&&(C(f>10?C(4):C(2)?d%A>P%A?1:3:d/A>P/A?2:0,d),K-5||(Z[1]-=f-8)>0||D||(I=" +/U.$v#x",Z[D=1]=5));d="";for(e in M){d=Z[e]>0?" "+I[e]+Z[e]+d:d;for(f=M[e],i=A;i--;)f=M[P+(i*(e%A-P%A)/A|0)+(i*(e/A-P/A)/A|0)*A]>5?0:f;e%A||(d+="\n");d+=I[f]||f-8}document.body.innerHTML="<pre>Zone:"+(L||"END")+d}